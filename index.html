<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Happy Birthday Ph∆∞∆°ng Th·∫£o</title>
    <style>
      body {
        margin: 0;
        background: black;
        font-family: monospace;
        height: 100vh;
        color: #0f0;
        box-sizing: border-box;
        overflow-x: hidden;
      }

      /* Falling Hearts */
      #heartCanvas {
        position: fixed;
        inset: 0;
        z-index: 0;
        width: 100%;
        height: 100%;
        background: black;
      }

      /* Countdown */
      #countdown {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30vw;
        color: white;
        background: pink;
        z-index: 10;
        font-weight: bold;
        transition: opacity 0.5s ease;
      }

      /* N·ªôi dung ch√≠nh */
      .center-container {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        text-align: center;
        z-index: 2;
        color: white;
      }
      .center-text {
        font-size: 10vw;
        font-weight: bold;
        opacity: 0;
        transition: opacity 1s ease-in-out;
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.6);
        max-width: 90%;
        word-wrap: break-word;
      }
      .show {
        opacity: 1;
      }

      /* Tr√°i tim ch·ª©a c√¢u ch√∫c */
      .heart-shape {
        position: relative;
        width: 25vw;
        height: 22vw;
        background-color: pink;
        transform: rotate(-45deg);
        animation: heartbeat 1.2s infinite;
        z-index: 0;
      }
      .heart-shape::before,
      .heart-shape::after {
        content: "";
        position: absolute;
        width: 25vw;
        height: 22vw;
        background-color: pink;
        border-radius: 50%;
        z-index: 0;
      }
      .heart-shape::before {
        top: -12.5vw;
        left: 0;
      }
      .heart-shape::after {
        left: 12.5vw;
        top: 0;
      }
      .heart-text {
        position: absolute;
        width: 80%;
        height: 80%;
        top: 37%;
        left: 62%;
        transform: translate(-50%, -50%) rotate(45deg);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2vw;
        font-size: 2vw !important;
        color: white;
        text-align: center;
        line-height: 1.4;
        word-wrap: break-word;
        overflow-wrap: break-word;
        z-index: 1;
      }
      @keyframes heartbeat {
        0%,
        100% {
          transform: rotate(-45deg) scale(1);
        }
        50% {
          transform: rotate(-45deg) scale(1.05);
        }
      }

      /* Hi·ªáu ·ª©ng l·∫•p l√°nh quanh tr√°i tim */
      .sparkle {
        position: absolute;
        width: 5px;
        height: 5px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 0 5px 2px rgba(255, 255, 255, 0.8);
        animation: sparkle 1.5s infinite;
        z-index: 1;
      }
      @keyframes sparkle {
        0% {
          opacity: 0;
          transform: scale(0.5);
        }
        50% {
          opacity: 1;
          transform: scale(1.2);
        }
        100% {
          opacity: 0;
          transform: scale(0.5);
        }
      }

      /* N√∫t b·∫≠t nh·∫°c */
      #play-btn {
        position: fixed;
        bottom: 2vw;
        right: 2vw;
        padding: 1.5vw 2vw;
        font-size: 3vw;
        background: hotpink;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        z-index: 999;
      }

      /* Media Queries for Mobile */
      @media screen and (max-width: 768px) {
        #countdown {
          font-size: 20vw;
        }
        .center-text {
          font-size: 8vw;
        }
        .heart-shape {
          width: 50vw;
          height: 45vw;
        }
        .heart-shape::before,
        .heart-shape::after {
          width: 50vw;
          height: 45vw;
        }
        .heart-shape::before {
          top: -25vw;
        }
        .heart-shape::after {
          left: 25vw;
        }
        .heart-text {
          font-size: 4vw !important;
          padding: 3vw;
        }
        #play-btn {
          font-size: 4vw;
          padding: 2vw 3vw;
        }
      }
    </style>
  </head>
  <body>
    <canvas id="heartCanvas"></canvas>

    <div id="countdown">3</div>

    <!-- N·ªôi dung ch√≠nh -->
    <div class="center-container">
      <div id="display" class="center-text"></div>
    </div>

    <!-- Nh·∫°c n·ªÅn -->
    <audio id="bg-music" loop preload="auto">
      <source src="./cmsn.mp3" type="audio/mpeg" />
    </audio>
    <button id="play-btn">üéµ B·∫≠t nh·∫°c</button>

    <script>
      // Falling Hearts Canvas
      const heartCanvas = document.getElementById("heartCanvas");
      const heartCtx = heartCanvas.getContext("2d");
      const heartFontSize = 12;
      let heartDrops = [];

      // Responsive canvas sizing
      function resizeCanvas() {
        heartCanvas.height = window.innerHeight;
        heartCanvas.width = window.innerWidth;

        const heartColumns = Math.floor(heartCanvas.width / heartFontSize);
        const newHeartDrops = new Array(heartColumns).fill(1);
        for (let i = 0; i < Math.min(heartDrops.length, heartColumns); i++) {
          newHeartDrops[i] = heartDrops[i] || 1;
        }
        heartDrops = newHeartDrops;
      }
      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

      function drawHearts() {
        heartCtx.fillStyle = "rgba(0, 0, 0, 0.05)";
        heartCtx.fillRect(0, 0, heartCanvas.width, heartCanvas.height);
        heartCtx.fillStyle = "pink";
        heartCtx.font = heartFontSize + "px monospace";
        for (let i = 0; i < heartDrops.length; i++) {
          const speed = Math.random() * 0.5 + 0.5;
          heartCtx.fillText(
            "‚ù§Ô∏è",
            i * heartFontSize,
            heartDrops[i] * heartFontSize
          );
          if (
            heartDrops[i] * heartFontSize > heartCanvas.height &&
            Math.random() > 0.98
          ) {
            heartDrops[i] = 0;
          }
          heartDrops[i] += speed;
        }
      }

      // Countdown
      let count = 3;
      const countdownEl = document.getElementById("countdown");
      const countdownInterval = setInterval(() => {
        count--;
        if (count > 0) {
          countdownEl.textContent = count;
        } else {
          clearInterval(countdownInterval);
          countdownEl.style.opacity = 0;
          setTimeout(() => countdownEl.remove(), 500);
          setInterval(drawHearts, 50);
          showMessage();
        }
      }, 1000);

      // Messages
      const display = document.getElementById("display");
      const messages = [
        "IMG: ./happy-birthday.gif",
        "PH∆Ø∆†NG TH·∫¢O ‚ù§Ô∏è",
        "Ch√∫c em m·ªôt ng√†y sinh nh·∫≠t si√™u r·ª±c r·ª°! üéâ",
        "IMG: ./cupble.jpg",
        "13.08.2025",
        "HEART",
      ];
      const wishText =
        "Ch√∫c em sinh nh·∫≠t th·∫≠t nhi·ªÅu ni·ªÅm vui, lu√¥n xinh ƒë·∫πp, h·∫°nh ph√∫c v√† m√£i l√† c√¥ g√°i anh y√™u th∆∞∆°ng nh·∫•t üíï";
      let index = 0;

      // Audio playback with enhanced error handling
      const audio = document.getElementById("bg-music");
      const playBtn = document.getElementById("play-btn");

      audio.addEventListener("error", (e) => {
        console.error("Audio file error:", e);
        playBtn.textContent = "üéµ L·ªói t·∫£i nh·∫°c";
        playBtn.disabled = true;
      });

      audio.addEventListener("canplay", () => {
        console.log("Audio file is ready to play");
      });

      playBtn.addEventListener("click", function () {
        if (
          typeof audio.context !== "undefined" &&
          audio.context.state === "suspended"
        ) {
          audio.context.resume().then(() => {
            console.log("Audio context resumed");
          });
        }

        audio
          .play()
          .then(() => {
            console.log("Audio playback started successfully");
            playBtn.remove();
          })
          .catch((error) => {
            console.error("Audio playback failed:", error.message);
            playBtn.textContent = "üéµ Th·ª≠ l·∫°i";
            const errorMsg = document.createElement("div");
            errorMsg.textContent = "Kh√¥ng th·ªÉ ph√°t nh·∫°c, vui l√≤ng th·ª≠ l·∫°i!";
            errorMsg.style.color = "red";
            errorMsg.style.position = "fixed";
            errorMsg.style.top = "10px";
            errorMsg.style.left = "50%";
            errorMsg.style.transform = "translateX(-50%)";
            errorMsg.style.zIndex = "1000";
            document.body.appendChild(errorMsg);
            setTimeout(() => errorMsg.remove(), 3000);
          });
      });

      function showMessage() {
        display.classList.remove("show");
        setTimeout(() => {
          display.innerHTML = "";

          if (messages[index].startsWith("IMG:")) {
            const img = document.createElement("img");
            img.src = messages[index].replace("IMG:", "").trim();
            img.style.maxWidth = "80%";
            img.style.height = "auto";
            img.style.borderRadius = "15px";
            display.appendChild(img);
          } else if (messages[index] === "HEART") {
            const heart = document.createElement("div");
            heart.classList.add("heart-shape");
            const heartText = document.createElement("div");
            heartText.classList.add("heart-text");
            heartText.textContent = wishText;
            heart.appendChild(heartText);
            // Add sparkles around the heart
            for (let i = 0; i < 6; i++) {
              const sparkle = document.createElement("div");
              sparkle.classList.add("sparkle");
              const angle = (Math.PI * 2 * i) / 6;
              const radius = Math.random() * 15 + 15;
              sparkle.style.left = `calc(50% + ${Math.cos(angle) * radius}vw)`;
              sparkle.style.top = `calc(50% + ${Math.sin(angle) * radius}vw)`;
              sparkle.style.animationDelay = `${Math.random() * 0.5}s`;
              heart.appendChild(sparkle);
            }
            display.appendChild(heart);
          } else {
            display.textContent = messages[index];
          }

          display.classList.add("show");
          index++;
          if (index < messages.length) {
            setTimeout(showMessage, 2500);
          }
        }, 1000);
      }
    </script>
  </body>
</html>
